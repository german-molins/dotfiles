# Bash startup profiling function
profile_source() {
  if [ "$BASH_PROFILE_TIMING" = "1" ]; then
    local log_dir="$HOME/.local/share/dotfiles/bash"
    local log_file="$log_dir/profile_timing.log"
    
    # Initialize/overwrite log file on first call of this session
    if [ -z "$_PROFILE_SESSION_STARTED" ]; then
      mkdir -p "$log_dir"
      >"$log_file"
      export _PROFILE_SESSION_STARTED=1
      echo "Bash profiling enabled. Log will be written to $log_file"
    fi

    local start_time=$EPOCHREALTIME
    source "$1"
    local end_time=$EPOCHREALTIME
    echo "$start_time $end_time $1" >>"$log_file"
  else
    source "$1"
  fi
}

for file in ~/.bashrc.d/*.sh; do
  if [ -r "$file" ]; then
    # Bypass profiling for atuin to preserve execution context
    if [[ "$file" == *"atuin"* ]]; then
      source "$file"
    else
      profile_source "$file"
    fi
  fi
done
unset file

if [ -r /etc/bash_completion ] && ! shopt -oq posix; then
  profile_source /etc/bash_completion
fi

shopt -s extglob
shopt -s globstar
#shopt -s nullglob

shopt -s autocd
shopt -s cdspell
shopt -s cdable_vars

shopt -s checkjobs
shopt -s histappend
shopt -s checkwinsize

set -o noclobber
set -o vi

where
