#!/bin/sh

###
# Configures the input device 'Kensington Slimblade Trackball' for the X-Server
# using a preferred set of hardcoded values, either right-handed (default) or
# left-handed. Once configured, this handedness persists in file
# "~/.config/kenington-slimblade.conf", used if no handedness argument
# provided.
###

readonly product='Kensington Slimblade Trackball'
readonly driver=libinput
readonly conf_file_name=kenington-slimblade.conf
readonly conf_file_path="$HOME/.config/$conf_file_name"

setprop ()
{
	option="$1"
	shift
	value="$@"

	xinput set-prop "$product" "$driver $option" $value
}

###
# Set properties as right-handed.
###
setprops_rh ()
{
	xinput set-button-map "$product" 1 8 2 4 5 0 0 3
	setprop 'Natural Scrolling Enabled' 0
}

###
# Set properties as left-handed.
###
setprops_lh ()
{
	xinput set-button-map "$product" 2 3 1 4 5 0 0 8
	setprop 'Natural Scrolling Enabled' 1
}

wrong_usage ()
{
	>&2 echo "Wrong usage. Use with --help for more details."
}

###############################################################################

this_name="$(basename "$0")"

if [ $# -eq 0 ]
then
	if [ -f "$conf_file_path" ]
	then
		. "$conf_file_path"
	else
		handedness=right-handed
	fi
elif [ $# -eq 1 ]
then
	handedness="$1"
else
	wrong_usage
	exit 1
fi

case "$handedness" in
(right-handed|rh)
	setprops_rh
	;;
(left-handed|lh)
	setprops_lh
	;;
(-h|--help)
	echo "usage: $this_name [right-handed | left-handed | --help]"
	exit 0
	;;
(*)
	wrong_usage
	exit 1
	;;
esac

echo "handedness=$handedness" >"$conf_file_path"
exit 0
