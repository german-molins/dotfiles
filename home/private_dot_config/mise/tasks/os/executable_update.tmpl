#!/usr/bin/env bash
#MISE description="Update system packages"
#MISE alias="distro:update"
#USAGE flag "--clean" help="Clean up after update"

set -e

{{ if eq .chezmoi.os "darwin" -}}
brew update 
brew upgrade 

if [ "$usage_clean" = "true" ]; then
  brew cleanup
fi

{{- else if eq .chezmoi.os "linux" -}}

{{ if eq .chezmoi.osRelease.id "ubuntu" -}}
sudo apt update
sudo apt upgrade -y

if [ "$usage_clean" = "true" ]; then
  sudo apt autoremove -y
fi

{{ else if eq .chezmoi.osRelease.id "debian" -}}
sudo apt update
sudo apt upgrade -y

if [ "$usage_clean" = "true" ]; then
  sudo apt autoremove -y
fi

{{ else if eq .chezmoi.osRelease.id "fedora" -}}
sudo dnf update -y

if [ "$usage_clean" = "true" ]; then
  sudo dnf autoremove -y
fi

{{ else if eq .chezmoi.osRelease.id "centos" -}}
sudo dnf update -y

if [ "$usage_clean" = "true" ]; then
  sudo dnf autoremove -y
fi

{{ else if eq .chezmoi.osRelease.id "arch" -}}
sudo pacman -Syu --noconfirm

if [ "$usage_clean" = "true" ]; then
  sudo pacman -Rns $(pacman -Qdtq) --noconfirm 2>/dev/null
  sudo pacman -Sc --noconfirm
fi

{{ else -}}
echo "[dotfiles] Unknown Linux distribution: {{ .chezmoi.osRelease.id }}"
echo "[dotfiles] Please update this script to support your distribution."
exit 1
{{ end -}}

{{ else }}
echo "[dotfiles] Unsupported operating system: {{ .chezmoi.os }}"
echo "[dotfiles] Please update this script to support your OS."
exit 1
{{ end }}
